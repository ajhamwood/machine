var $=(()=>{let s=new WeakMap,i=Object.values,o=Promise.resolve.bind(Promise),a=(e,t)=>e.constructor===t||t.prototype.isPrototypeOf(e),l=(e,t,n,r=s.get(e)??{})=>{c(e,t,n.name);e.addEventListener(t,(r[t]??={})[n.name]=n);s.set(e,r)},c=(e,t,n,r=s.get(e))=>{if(r&&t in r&&n in r[t]){e.removeEventListener(t,r[t][n]);delete r[t][n]&&(i(r[t]).length||delete r[t])&&(i(r).length||s.delete(e))}};return Object.assign((e,t=document)=>t.querySelector(e),{all(e,t=document){return i(t.querySelectorAll(e))},Machine:class{constructor(e){let n=Object.seal(e);s.set(this,{es:{},state:Object.seal(e)});for(let t in n)Object.defineProperty(this,t,{get:()=>n[t],set:e=>n[t]=e})}state(){return s.get(this).state}on(e,t){(s.get(this).es[e]??=new Map).set(t.name,t);return this}stop(e,t=e){let{es:n}=s.get(this);n[e]?.delete(t)&&(n[e].size||delete n[e]);return this}emit(e,...n){return(t=>(s.get(this).es[e]?.forEach(e=>t[e.name]=e.apply(this,n)),t))({})}emitAsync(t,...r){return(e=>(s.get(this).es[t]?.forEach(n=>e=e.then(t=>o(n.apply(this,r)).then(e=>({...t,[n.name]:e})))),e))(o({}))}},pipe:(n=>(e,...t)=>n[e]=(n[e]??o()).then(()=>Promise.all(t.map(e=>a(e,Array)&&Promise.race(e.map(e=>e()))||a(e,Function)&&e()))))({}),targets(n,r=window){for(let t in n)if(a(n[t],Function)){if(a(r,$.Machine))t.split(" ").forEach(e=>r.on(e,n[t]));else if(a(r,EventTarget))t.split(" ").forEach(e=>l(r,e,n[t].bind(r)))}else if(a(n[t],String)){if(a(r,$.Machine))t.split(" ").forEach(e=>r.stop(e,n[t]));else if(a(r,EventTarget))t.split(" ").forEach(e=>c(r,e,"bound "+n[t]))}else if(t in r)$.targets(n[t],r[t]);else for(let e in r)if(e.match(new RegExp(`^${t}$`)))$.targets(n[t],r[e])},queries(s,t){for(let r in s){let e=$.all(r,t);if(e.length)for(let n in s[r])if(a(s[r][n],Function))n.split(" ").forEach(t=>e.forEach(e=>l(e,t,s[r][n].bind(e))));else if(a(s[r][n],String))n.split(" ").forEach(t=>e.forEach(e=>c(e,t,"bound "+s[r][n])))}},load(e,t="body",n){return $.all(t,n).map(t=>i($("template#"+e).content.cloneNode(true).children).map(e=>t.appendChild(e)))},loadWc(t,{constructor:n,...e},r=[]){class s extends HTMLElement{static get observedAttributes(){return r}constructor(...e){super();this.attachShadow({mode:"open"}).appendChild($("#"+t).content.cloneNode(true));n.apply(this,e)}}Object.assign(s.prototype,e);customElements.define(t,s)}})})();